<%= bootstrap_nested_form_for(@bot, data: { event_name: "Update bot", bot_id: @bot.id, bot_name: @bot.name }) do |f| %>
  <%= render "shared/errors", object: @bot %>

  <%= f.text_field :name %>
  <%= f.file_field :image %>
  <% if @bot.image %>
    <%= image_tag @bot.image_url(:thumb) %>
    <br />
    <br />
  <% end %>
  <%= f.text_area :classify_failed_message, rows: 3 %>
  <%= f.text_area :start_message, rows: 3 %>
  <hr />

  <%= f.form_group nil, label: { text: '埋め込みコード' } do %>
    <div class="form-group form-inline">
      高さ: <%= text_field_tag :width, 500, class: 'form-control' %>&nbsp;&nbsp;
      幅: <%= text_field_tag :height, 500, class: 'form-control' %>
    </div>
    <%= text_field_tag :embed, bot_embed_code(@bot), class: 'form-control', readonly: true %>
  <% end %>

  <div class="form-group form-inline">
    <div class="panel panel-default">
      <div class="panel-heading">
        <label>チャット埋め込みの許可ホスト</label><br />
      </div>
      <div class="panel-body">
        <div id="bot-allowed-hosts">
          <%= f.fields_for :allowed_hosts do |nf| %>
            <%= nf.select :scheme, AllowedHost.schemes.keys, class: 'form-control', hide_label: true %>
            <%= nf.text_field :domain, class: 'form-control', hide_label: true, placeholder: '*.example.com' %>
            <%= nf.link_to_remove '削除', class: 'btn btn-danger', data: { confirm: '本当に削除してよろしいですか？' } %>
            <hr />
          <% end %>
        </div>
        <%= f.link_to_add '許可ホストを追加', :allowed_hosts, class: 'btn btn-default', data: { target: '#bot-allowed-hosts' } %>
        <p class="help-block">
          ※１つも登録がない場合すべてのホストに対して埋め込みが許可されます<br />
          ※追加と削除を行ったら必ず更新するボタンを押してください<br />
          ※サブドメインは <code>*</code> で全てにマッチできます（例：*.example.com）サブドメイン無しは個別に登録する必要があります
        </p>
      </div>
    </div>
  </div>

  <div class="actions">
    <%= f.submit class: 'btn btn-success' %>
    <div class="pull-right">
      <span data-component="BotResetButton"
            data-url="<%= reset_bot_path(@bot) %>"></span>
    </div>
  </div>
  <%= javascript_include_tag 'bots/form' %>
<% end %>
